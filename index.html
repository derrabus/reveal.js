<!doctype html>  
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		
		<title>The Dark Side of Traits</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Alexander M. Turek">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/derrabus.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	
	<body>
		
		<div class="reveal">

			<!-- Used to fade in a background when a specific slide state is reached -->
			<div class="state-background"></div>
			
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>The Dark Side<br/>of Traits</h1>
					<h3>Dipl.-Inform. Alexander M. Turek</h3>
				</section>
                <section>
                    <h2>outline</h2>
                    <p>object-oriented code reuse</p>
                    <p>anatomy of a trait</p>
                    <p>use-cases for traits</p>
                    <p>the dark side of traits</p>
                </section>
                <section>
                    <h2>about me</h2>
                    <h3>Alexander M. Turek</h3>
                    <p>software developer</p>
                    <p>freelancer</p>
                    <p>php enthusiast</p>
                    <p>based in Munich, Germany</p>
                </section>
                <section>
                    <h2>poor man's code reuse</h2>
                    <section>
                        <h3>level 1</h3>
                        <p><em>&quot;All my classes need to handle errors.&quot;</em></p>
                        <p><em>&quot;I don't want to copy&amp;paste my error handling code.&quot;</em></p>
                        <p><em>&quot;Let's build an abstract class for that!&quot;</em></p>
                    </section>
                    <section>
                        <h3>level 1</h3>
                        <pre><code>abstract class MyError {
    protected function handleError($message) {
        throw new MyException($message);
    }
}

class SomeClass extends MyError {
    &#133;
}</code></pre>
                    </section>
                    <section>
                        <h3>level 2</h3>
                        <p><em>&quot;My classes <u>might</u> need to log stuff.&quot;</em></p>
                        <p><em>&quot;But I only have single inheritance&#133;&quot;</em></p>
                    </section>
                    <section>
                        <h3>level 2</h3>
                        <pre><code>abstract class MyObject {
    protected function handleError($message) { &#133; }
    protected function log($level, $message) { &#133; }

    &#133;
}

class SomeClass extends MyObject {
    &#133;
}</code></pre>
                    </section>
                    <section>
                        <h3>level 3</h3>
                        <pre><code>abstract class MyAdamClass {
    protected function handleError($message) { &#133; }
    protected function log($level, $message) { &#133; }
    protected function sort($array) { &#133; }
    protected function queryDb($sql) { &#133; }
    protected function sendMail($to, $subject, $message) { &#133; }
    protected function makeCoffee($type) { &#133; }
    protected function orderPizza($toppings, $size) { &#133; }

    &#133;
}

class SomeClass extends MyError {
    &#133;
}</code></pre>
                    </section>
                    <section>
                        <h3>guess what?</h3>
                        <p>inheritance is not a mechanism of code reuse</p>
                        <p>this is not breaking news, is it?</p>
                    </section>
                </section>
                <section>
                    <h2>class composition</h2>
                    <section>
                        <h3>favor composition over inheritance</h3>
                        <img src="img/logger-composition.svg"/>
                    </section>
                    <section>
                        <h3>pros</h3>
                        <p>avoid tight coupling</p>
                        <p>separation of concerns</p>
                        <p>dependencies may be replaced</p>
                        <p>improve testability</p>
                    </section>
                    <section>
                        <h3>but&#133;</h3>
                        <pre><code>class SomeClass {
    private $logger;

    public function setLogger(Logger $logger) {
        $this->logger = $logger;
    }

    private function log($level, $message) {
        if (!is_null($this->logger)) {
            $this->logger->log($level, $message);
        }
    }

    &#133;
}</code></pre>
                    </section>
                    <section>
                        <h3>glue code pollution</h3>
                        <p>classes need to handle their dependencies</p>
                        <p>copy&amp;paste boilerplate code</p>
                        <p>very low complexity though</p>
                    </section>
                    <section>
                        <h3>what's missing?</h3>
                        <p>there is no way to express composition on language level</p>
                        <p>once again: inheritance is not the answer</p>
                        <p><small>PS: introducing multiple inheritance isn't either</small></p>
                    </section>
                </section>
                <section>
                    <h2>traits</h2>
                    <section>
                        <h3>building blocks for classes</h3>
                        <blockquote cite="http://springerlink.metapress.com/content/169mbraepn4gmyd2/">
                            [&#133;] Our model is based on lightweight entities called traits, which serve as the basic
                            building blocks for classes and the primitive units of code reuse. Thus, traits satisfy the
                            needs for structure, modularization and reusability within a class.
                        </blockquote>
                        <p><small>
                            Nathanael Schärli, Stéphane Ducasse, Oscar Nierstrasz, Andrew P. Black. Traits: Composable Units
                            of Behaviour. Proceedings of the European Conference on Object-Oriented Programming (ECOOP).
                            Lecture Notes in Computer Science, Volume 2743, Springer-Verlag, 2003, pp. 248-274
                        </small></p>
                    </section>
                    <section>
                        <h3>the logger example</h3>
                        <pre><code>trait LogTrait {
    private function log($level, $message) {
        &#133;
    }
}

class SomeClass {
    use LogTrait;

    &#133;
}</code></pre>
                    </section>
                    <section>
                        <p>&quot;compiler-assisted copy&amp;paste&quot;</p>
                        <p>large classes can be decomposed into traits</p>
                        <p>traits can be shared across classes</p>
                        <p>horizontal code reuse</p>
                    </section>
                </section>
                <section>
                    <h2>the singleton trait</h2>
                    <section>
                        <h3>without traits</h3>
                        <pre><code>class SomeClass {
    private static $instance;

    public static function getInstance() {
        if (!isset(self::$instance)) {
            self::$instance = new SomeClass;
        }
        return self::$instance;
    }
}</code></pre>
                    </section>
                    <section>
                        <h3>with traits</h3>
                        <pre><code>trait Singleton {
    private static $instance;

    public static function getInstance() {
        if (!isset(self::$instance)) {
            self::$instance = new self;
        }
        return self::$instance;
    }
}

class SomeClass {
    use Singleton;
}</code></pre>
                    </section>
                    <section>
                        <h3>disclaimer</h3>
                        <p>I don't want to promote Singleton as a good pattern.</p>
                    </section>
                </section>
                <section>
                    <h2>the observer trait</h2>
                    <section>
                        <h3>observer pattern</h3>
                        <img src="img/wikipedia-observer.svg"/>
                        <p>
                            <small>
                                source:
                                <a href="http://en.wikipedia.org/wiki/Observer_pattern">http://en.wikipedia.org/wiki/Observer_pattern</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>observer subject as trait</h3>
                        <pre><code><small>interface Observer {
    public function notify();
}

trait Subject {
    private $observers = array();

    public function registerObserver(Observer $observer) {
        if (!in_array($observer, $this->observers, true)) {
            $this->observers[] = $observer;
        }
    }

    public function unregisterObserver(Observer $observer) {
        foreach ($this->observers as $key => $current) {
            if ($current === $observer) {
                unset($this->observers[$key]);
            }
        }
    }

    public function notifyObservers() {
        foreach ($this->observers as $current) {
            $current->notify();
        }
    }
}</small></code></pre>
                    </section>
                </section>
                <section>
                    <h2>so&#133;</h2>
                    <h3>&#133; traits are awesome?</h3>
                </section>
                <section>
                    <h2>private access</h2>
                    <section>
                        <h3>back in the good ol' days&#133;</h3>
                        <p class="fragment">&#133; private members were accessible within their own class only</p>
                        <p class="fragment">well, breaking news: these days are gone</p>
                    </section>
                    <section>
                        <h3>even worse</h3>
                        <p>private methods may now define an interface</p>
                        <p>communication between two traits</p>
                        <p>communication between a trait and its host class</p>
                    </section>
                    <section>
                        <h3>abstract private</h3>
                        <p>however: abstract private is still now allowed</p>
                        <pre><code>trait SayHello {
    public function say() {
        echo 'Hello ' . $this->getName() . '!' . "\n";
    }

    abstract protected function getName();
}

class SomeClass {
    use SayHello;

    private function getName() {
        return 'World';
    }
}</code></pre>
                    </section>
                    <section>
                        <h3>traits will touch your privates</h3>
                        <p>readability fail</p>
                        <p>changeability fail</p>
                        <p>testability fail</p>
                    </section>
                </section>
                <section>
                    <h2>testability</h2>
                    <section>
                        <h3>say hello to tight coupling again</h3>
                        <p>testability issues with abstract classes apply here, too</p>
                    </section>
                    <section>
                        <h3>proxy classes</h3>
                        <p>traits cannot be tested directly, so we always need a proxy class</p>
                        <p>PHPUnit provides a <code>getObjectForTrait()</code> method</p>
                        <p><small>&#133; but it fails on traits with abstract members</small></p>
                    </section>
                    <section>
                        <h3>test isolation</h3>
                        <p>a trait is a hard-wired dependency</p>
                        <pre><code>class SomeClass {
    use SomeTrait;

    &#133;
}</code></pre>
                        <p class="fragment">classes cannot be tested without testing the trait</p>
                    </section>
                </section>
			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
			</aside>

			<!-- Presentation progress bar -->
			<div class="progress"><span></span></div>
			
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>
			
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				
				theme: Reveal.getQueryHash().theme || 'derrabus', // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/linear(2d)

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
					{ src: 'plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
				]
			});
			
		</script>

	</body>
</html>
